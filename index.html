<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Schnauzer Escape</title>
    <style>
        body { 
            margin: 0; overflow: hidden; background: #78B159; 
            font-family: -apple-system, sans-serif; touch-action: none; user-select: none;
        }
        #ui {
            position: absolute; top: env(safe-area-inset-top, 20px); left: 10px; right: 10px;
            display: flex; flex-direction: column; gap: 10px; pointer-events: none;
        }
        /* Barre de vie style jeu de combat */
        .health-container {
            width: 200px; height: 20px; background: rgba(0,0,0,0.5);
            border: 2px solid white; border-radius: 10px; overflow: hidden;
        }
        #health-bar {
            width: 100%; height: 100%; background: linear-gradient(to right, #ff416c, #ff4b2b);
            transition: width 0.3s ease;
        }
        #kibble-count { color: white; font-weight: bold; font-size: 18px; text-shadow: 1px 1px 2px black; }
        
        /* Bouton Croquette */
        #kibble-btn {
            position: absolute; bottom: 40px; right: 30px;
            width: 80px; height: 80px; background: rgba(255,255,255,0.2);
            border-radius: 50%; display: flex; justify-content: center;
            align-items: center; font-size: 40px; border: 3px solid white;
            pointer-events: auto; touch-action: manipulation;
        }
        #game-over {
            position: absolute; inset: 0; background: rgba(0,0,0,0.8);
            display: none; flex-direction: column; justify-content: center;
            align-items: center; color: white; z-index: 100;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div class="health-container"><div id="health-bar"></div></div>
        <div id="kibble-count">ü¶¥ Croquettes: 10</div>
    </div>

    <div id="kibble-btn">ü•©</div>

    <div id="game-over">
        <h1>L√©ch√© ! üê∂</h1>
        <button onclick="location.reload()" style="padding:15px 30px; font-size:20px; border-radius:10px;">Rejouer</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const healthBar = document.getElementById('health-bar');
        const kibbleText = document.getElementById('kibble-count');
        const kibbleBtn = document.getElementById('kibble-btn');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let health = 10;
        let kibblesLeft = 10;
        let gameActive = true;

        const player = { x: canvas.width/2, y: canvas.height/2, size: 50, emoji: "üë±‚Äç‚ôÇÔ∏è" };
        const dog = { x: 50, y: 50, size: 50, emoji: "üê∂", speed: 2 };
        let activeKibble = null;

        // Contr√¥les
        window.addEventListener('touchmove', (e) => {
            if(!gameActive) return;
            player.x = e.touches[0].clientX - 25;
            player.y = e.touches[0].clientY - 25;
        }, {passive: false});

        kibbleBtn.addEventListener('touchstart', (e) => {
            if(kibblesLeft > 0 && !activeKibble) {
                activeKibble = { x: player.x, y: player.y, timer: 150 };
                kibblesLeft--;
                kibbleText.innerText = "ü¶¥ Croquettes: " + kibblesLeft;
            }
            e.stopPropagation();
        });

        function update() {
            if(!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Cible du chien : Croquette ou Joueur
            let target = activeKibble ? activeKibble : player;
            
            // Le chien avance vers la cible
            let dx = (target.x + 25) - (dog.x + 25);
            let dy = (target.y + 25) - (dog.y + 25);
            let dist = Math.sqrt(dx*dx + dy*dy);
            
            if(dist > 5) {
                dog.x += (dx/dist) * dog.speed;
                dog.y += (dy/dist) * dog.speed;
            }

            // Dessiner Croquette
            if(activeKibble) {
                ctx.font = "30px serif";
                ctx.fillText("ü•©", activeKibble.x, activeKibble.y + 30);
                activeKibble.timer--;
                if(activeKibble.timer <= 0) activeKibble = null;
            }

            // Dessiner Joueur (Malfoy blond)
            ctx.font = "50px serif";
            ctx.fillText(player.emoji, player.x, player.y + 40);

            // Dessiner Chien
            ctx.fillText(dog.emoji, dog.x, dog.y + 40);

            // Collision avec le joueur
            if(!activeKibble && dist < 40) {
                health -= 0.05; // D√©g√¢ts continus si touch√©
                healthBar.style.width = (health * 10) + "%";
                if(health <= 0) {
                    gameActive = false;
                    document.getElementById('game-over').style.display = 'flex';
                }
            }

            requestAnimationFrame(update);
        }

        update();
    </script>
</body>
</html>
