<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>William vs Schnauzers</title>
    <style>
        body { 
            margin: 0; overflow: hidden; background: #5a8a3c; 
            font-family: 'Arial Black', sans-serif; touch-action: none; user-select: none;
        }
        #ui {
            position: absolute; top: env(safe-area-inset-top, 20px); left: 10px; right: 10px;
            display: flex; flex-direction: column; gap: 8px; pointer-events: none; z-index: 10;
        }
        .health-container {
            width: 250px; height: 25px; background: rgba(0,0,0,0.6);
            border: 3px solid #fff; border-radius: 12px; overflow: hidden;
        }
        #health-bar {
            width: 100%; height: 100%; background: linear-gradient(90deg, #ff0000, #ff8800);
            transition: width 0.2s ease;
        }
        #stats { color: white; font-size: 18px; text-shadow: 2px 2px #000; }
        
        #kibble-btn {
            position: absolute; bottom: 30px; right: 30px;
            width: 70px; height: 70px; background: rgba(255,255,255,0.3);
            border-radius: 50%; display: flex; justify-content: center;
            align-items: center; font-size: 35px; border: 4px solid gold;
            cursor: pointer; z-index: 20;
        }

        /* Animation FIGHT */
        #intro-text {
            position: absolute; inset: 0; display: flex; justify-content: center; 
            align-items: center; color: #ff0000; font-size: 10px; font-weight: bold;
            text-align: center; text-shadow: 4px 4px #fff; pointer-events: none;
            opacity: 0; z-index: 50;
        }
        .animate-intro { animation: zoomText 2s ease-out forwards; }
        @keyframes zoomText {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(5); opacity: 1; }
            100% { transform: scale(8); opacity: 0; }
        }

        #game-over {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; justify-content: center;
            align-items: center; color: white; z-index: 100;
        }
        button { padding: 15px 30px; font-size: 20px; cursor: pointer; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="intro-text">WILLIAM :<br>FUIT VITE</div>
    
    <div id="ui">
        <div class="health-container"><div id="health-bar"></div></div>
        <div id="stats">ü¶¥ Croquettes: <span id="k-count">10</span></div>
    </div>

    <div id="kibble-btn" title="Appuie pour attirer les chiens">ü•©</div>

    <div id="game-over">
        <h1>L√âCH√â ! üê∂</h1>
        <button onclick="location.reload()">REJOUER</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const healthBar = document.getElementById('health-bar');
        const kCountText = document.getElementById('k-count');
        const kibbleBtn = document.getElementById('kibble-btn');
        const intro = document.getElementById('intro-text');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let health = 10;
        let kibblesLeft = 10;
        let gameActive = false; // Bloqu√© jusqu'√† la fin de l'intro
        let globalSpeed = 1.5;

        const player = { x: canvas.width/2, y: canvas.height/2, size: 50, emoji: "üßç" };
        const dogs = [
            { x: 50, y: 50, emoji: "üêï‚Äçü¶∫" },
            { x: canvas.width-100, y: 50, emoji: "üêï‚Äçü¶∫" }
        ];
        let activeKibble = null;

        // Lancement Intro
        window.onload = () => {
            intro.classList.add('animate-intro');
            setTimeout(() => { gameActive = true; update(); }, 2000);
        };

        // Contr√¥les Laptop (Fl√®ches)
        const keys = {};
        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        // Contr√¥les Tactile / Souris
        function moveHandler(e) {
            if(!gameActive) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            player.x = clientX - 25;
            player.y = clientY - 25;
        }
        canvas.addEventListener('touchmove', moveHandler, {passive: false});
        canvas.addEventListener('mousemove', moveHandler);

        // Action Croquette
        function dropKibble() {
            if(kibblesLeft > 0 && !activeKibble && gameActive) {
                activeKibble = { x: player.x, y: player.y, timer: 180 };
                kibblesLeft--;
                kCountText.innerText = kibblesLeft;
            }
        }
        kibbleBtn.addEventListener('mousedown', dropKibble);
        kibbleBtn.addEventListener('touchstart', (e) => { e.preventDefault(); dropKibble(); });
        window.addEventListener('keydown', (e) => { if(e.code === 'Space') dropKibble(); });

        function update() {
            if(!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // D√©placement clavier (Laptop)
            const pSpeed = 6;
            if(keys['ArrowUp']) player.y -= pSpeed;
            if(keys['ArrowDown']) player.y += pSpeed;
            if(keys['ArrowLeft']) player.x -= pSpeed;
            if(keys['ArrowRight']) player.x += pSpeed;

            // Acc√©l√©ration progressive des chiens
            globalSpeed += 0.0005;

            // Gestion de la Croquette
            if(activeKibble) {
                ctx.font = "40px serif";
                ctx.fillText("ü•©", activeKibble.x, activeKibble.y + 35);
                activeKibble.timer--;
                if(activeKibble.timer <= 0) activeKibble = null;
            }

            // Joueur
            ctx.font = "60px serif";
            ctx.fillText(player.emoji, player.x, player.y + 50);

            // Chiens
            dogs.forEach(dog => {
                let target = activeKibble ? activeKibble : player;
                let dx = (target.x + 25) - (dog.x + 25);
                let dy = (target.y + 25) - (dog.y + 25);
                let dist = Math.sqrt(dx*dx + dy*dy);
                
                if(dist > 5) {
                    dog.x += (dx/dist) * globalSpeed;
                    dog.y += (dy/dist) * globalSpeed;
                }

                ctx.font = "60px serif";
                ctx.fillText(dog.emoji, dog.x, dog.y + 50);

                // Collision avec joueur
                if(!activeKibble && dist < 45) {
                    health -= 0.04; 
                    healthBar.style.width = (health * 10) + "%";
                }
            });

            if(health <= 0) {
                gameActive = false;
                document.getElementById('game-over').style.display = 'flex';
                return;
            }

            requestAnimationFrame(update);
        }
    </script>
</body>
</html>
