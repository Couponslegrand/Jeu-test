<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Schnauzer Dodge</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #6B8E23; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            touch-action: none; /* D√©sactive les gestes par d√©faut du navigateur */
            user-select: none;
        }
        canvas { display: block; background: #8BC34A; }
        #ui { 
            position: absolute; 
            top: env(safe-area-inset-top, 20px); 
            left: 20px; 
            color: white; 
            font-size: 18px; 
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); 
            pointer-events: none; 
        }
        #game-over-screen {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        button {
            padding: 15px 40px;
            font-size: 20px;
            background: #FFD700;
            border: none;
            border-radius: 50px;
            color: #333;
            font-weight: bold;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="ui">‚ù§Ô∏è Vies: <span id="lives">10</span> | ‚≠ê Score: <span id="score">0</span></div>
    <canvas id="gameCanvas"></canvas>
    <div id="game-over-screen">
        <h1>L√©ch√© ! üê∂</h1>
        <p>Score final: <span id="final-score">0</span></p>
        <button onclick="location.reload()">REJOUER</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const livesElement = document.getElementById('lives');
        const scoreElement = document.getElementById('score');
        const gameOverScreen = document.getElementById('game-over-screen');
        const finalScoreElement = document.getElementById('final-score');

        // Ajustement √† la taille r√©elle de l'√©cran mobile
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        let lives = 10;
        let score = 0;
        let gameActive = true;
        let inDoghouse = false;

        const playerImg = new Image(); playerImg.src = 'player.png';
        const schnauzerImg = new Image(); schnauzerImg.src = 'schnauzer.png';
        const doghouseImg = new Image(); doghouseImg.src = 'doghouse.png';

        // Param√®tres adapt√©s au tactile
        const player = { 
            x: canvas.width / 2, 
            y: canvas.height - 120, 
            width: 60, 
            height: 80, 
            targetX: canvas.width / 2,
            targetY: canvas.height - 120
        };
        const doghouse = { x: 20, y: canvas.height - 160, width: 100, height: 120 };
        const schnauzers = [];

        // Gestion du tactile (le joueur suit le doigt)
        canvas.addEventListener('touchstart', handleTouch);
        canvas.addEventListener('touchmove', handleTouch);

        function handleTouch(e) {
            if (!gameActive) return;
            const touch = e.touches[0];
            player.targetX = touch.clientX - player.width / 2;
            player.targetY = touch.clientY - player.height / 2;
            e.preventDefault();
        }

        function spawnSchnauzer() {
            if (!gameActive) return;
            const size = Math.random() * 30 + 50;
            schnauzers.push({
                x: Math.random() * (canvas.width - size),
                y: -size,
                width: size,
                height: size,
                speed: Math.random() * 2 + 2 + (score / 20) // Acc√©l√®re avec le score
            });
            setTimeout(spawnSchnauzer, Math.max(400, 1500 - score * 10));
        }

        function update() {
            if (!gameActive) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // D√©placement fluide vers le doigt (interpolation)
            player.x += (player.targetX - player.x) * 0.2;
            player.y += (player.targetY - player.y) * 0.2;

            // Dessiner la niche
            ctx.drawImage(doghouseImg, doghouse.x, doghouse.y, doghouse.width, doghouse.height);

            // Zone de protection de la niche
            inDoghouse = (player.x < doghouse.x + doghouse.width && player.x + player.width > doghouse.x &&
                          player.y < doghouse.y + doghouse.height && player.y + player.height > doghouse.y);

            // Dessiner le joueur (translucide si dans la niche)
            ctx.globalAlpha = inDoghouse ? 0.5 : 1.0;
            ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
            ctx.globalAlpha = 1.0;

            // Schnauzers
            for (let i = schnauzers.length - 1; i >= 0; i--) {
                const s = schnauzers[i];
                s.y += s.speed;
                ctx.drawImage(schnauzerImg, s.x, s.y, s.width, s.height);

                // Collision
                if (!inDoghouse && 
                    player.x < s.x + s.width - 10 && player.x + player.width > s.x + 10 &&
                    player.y < s.y + s.height - 10 && player.y + player.height > s.y + 10) {
                    
                    lives--;
                    livesElement.innerText = lives;
                    schnauzers.splice(i, 1); // Le chien dispara√Æt apr√®s le "bisou"

                    if (lives <= 0) {
                        gameActive = false;
                        finalScoreElement.innerText = score;
                        gameOverScreen.style.display = 'flex';
                    }
                    continue;
                }

                if (s.y > canvas.height) {
                    schnauzers.splice(i, 1);
                    score++;
                    scoreElement.innerText = score;
                }
            }
            requestAnimationFrame(update);
        }

        // Soins dans la niche
        setInterval(() => {
            if (gameActive && inDoghouse && lives < 10) {
                lives++;
                livesElement.innerText = lives;
            }
        }, 1500);

        spawnSchnauzer();
        update();
    </script>
</body>
</html>
